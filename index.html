<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マルチプレイヤー ボス戦 アリーナ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div id="connection-modal" class="screen">
        <div class="title-container">
            <h2 id="connection-title">部屋に参加</h2>
            <p style="margin-bottom: 10px;"> 
                サーバーのアドレスを入力してください。<br>（例: `localhost:8080` または `ngrok-id.ngrok-free.app`）
            </p>
            <div class="input-group" style="margin-bottom: 25px;">
                <label for="server-address">接続アドレス:</label>
                <input type="text" id="server-address" placeholder="例: localhost:8080">
            </div>
            <button id="connect-submit" class="menu-button">接続して参加</button>
            <button id="connection-cancel" class="menu-button small" style="background: gray; margin-top: 10px;">キャンセル</button>
        </div>
    </div>
    
    <div id="title-screen" class="screen active">
        <div class="title-container">
            <h1>🛡️ マルチプレイヤー ボス戦</h1>
            <div style="margin-top: 40px; display: flex; flex-direction: column; gap: 15px;">
                <p>※ゲームを開始するには、まず`server.js`をNode.jsで実行してください。</p>
                <button id="create-room-button" class="menu-button">部屋を作成 (ホスト)</button>
                <button id="join-room-button" class="menu-button">部屋に参加 (ゲスト)</button>
            </div>
            <div id="connection-status" style="margin-top: 20px; font-weight: bold; color: #764ba2;">未接続</div>
        </div>
    </div>

    <div id="lobby-screen" class="screen">
        <div class="lobby-container">
            <h2>準備部屋 (Lobby)</h2>
            <div id="lobby-main-area">
                <div class="arena-preview">
                    <canvas id="lobby-canvas" width="600" height="600"></canvas>
                </div>
            </div>

            <div id="lobby-controls">
                
                <div id="job-selection-panel" class="lobby-panel">
                    <h4>職業選択 (WASDで移動し、近づいて[E]キーで転職、またはボタンで選択)</h4>
                    <div class="job-group">
                        <div class="job-info">
                            <h5>近接アタッカー (MELEE)</h5>
                        </div>
                        <button id="select-melee" class="menu-button small">選択</button>
                    </div>
                    <div class="job-group">
                        <div class="job-info">
                            <h5>遠距離アタッカー (RANGED)</h5>
                        </div>
                        <button id="select-ranged" class="menu-button small">選択</button>
                    </div>
                    <div class="job-group">
                        <div class="job-info">
                            <h5>ヒーラー (HEALER)</h5>
                        </div>
                        <button id="select-healer" class="menu-button small">選択</button>
                    </div>
                    <div class="job-group">
                        <div class="job-info">
                            <h5>サポーター (SUPPORTER)</h5>
                        </div>
                        <button id="select-supporter" class="menu-button small">選択</button>
                    </div>
                </div>
                
                <div id="host-settings-panel" class="lobby-panel" style="display: none;">
                    <h4>ホスト設定 (ホストのみ操作可能)</h4>
                    <div class="input-group">
                        <label for="boss-hp">ボス基礎HP (x1000):</label> 
                        <input type="range" id="boss-hp" min="10" max="100" value="10" step="1"> 
                        <span id="boss-hp-value">10,000 (x10)</span>
                    </div>
                    <div class="input-group">
                        <label for="boss-damage">ボスダメージ倍率:</label>
                        <input type="range" id="boss-damage" min="0.5" max="3.0" value="1.0" step="0.1">
                        <span id="boss-damage-value">1.0倍</span>
                    </div>
                </div>

                <div id="lobby-player-list" class="lobby-panel">
                    <h4>参加プレイヤー (0人):</h4>
                </div>

                <div class="gamepad-info lobby-panel">
                    <h3>操作説明</h3>
                    <p>WASD / 矢印キー: 移動</p>
                    <p>ロビー: [E]キーで近くの職業に転職</p>
                    <p>ゲーム中: [1]でスキル1, [2]でスキル2, [3]で大技</p>
                </div>

                <div class="button-group">
                    <button id="start-game-button" class="menu-button" style="display: none;" disabled>ゲーム開始</button>
                    <button id="lobby-disconnect-button" class="menu-button small" style="background: gray;">切断してタイトルに戻る</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="game-container">
            <div class="game-header">
                <button id="back-to-title" class="menu-button small">切断してタイトルに戻る</button>
                <span id="game-info">BOSS HP: <span id="boss-hp-display" style="color: red;">?</span></span>
            </div>
            
            <div class="game-main-view">
                <canvas id="game-canvas" width="800" height="800"></canvas>
            </div>
            
            <div class="skill-ui-placeholder">
                <p>スキル: [1], [2] 大技: [3]</p>
            </div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <div class="clear-container">
            <h2 id="result-title">戦闘終了！</h2>
            <p id="result-message">YOU WIN!</p>
            <table id="result-table">
                <thead>
                    <tr><th>プレイヤー</th><th>職業</th><th>死亡回数</th><th>与ダメージ</th><th>回復量</th></tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
            <button id="back-to-select-clear" class="menu-button">タイトルに戻る</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>